library(tidyverse)  # data management
library(skimr)      # descriptive statistics
library(janitor)    # data management
library(msm)        # model transition probabilities
library(tableone)   # create descriptives table
library(irr)        # calculate kappa for true and predicted alcohol use
# options(scipen=999) # prevent the use of scientific notation
# Specify the data and output file locations
data    <- "C:/Users/klajd/OneDrive/SIMAH/SIMAH_workspace/nesarc/Data/"
output  <- "C:/Users/klajd/OneDrive/SIMAH/SIMAH_workspace/nesarc/Output/"
models  <- "C:/Users/klajd/OneDrive/SIMAH/SIMAH_workspace/nesarc/Output/Models/"
source("0_Functions.R")
# Load data / functions
nesarc <- readRDS(paste0(data, "nesarc_clean.rds"))
nesarc_expanded <- readRDS(paste0(data, "nesarc_clean_expanded.rds"))
# for HED analyses, remove  those with missing HED data
nesarc_hed          <- nesarc %>% group_by(idnum) %>% filter(!any(is.na(hed))) %>% ungroup()
nesarc_expanded_hed <- nesarc_expanded %>% group_by(idnum) %>% filter(!any(is.na(hed)))%>% ungroup()
# Load Models
alc5.msm <- readRDS(paste0(models, "alc5.msm9.RDS"))
hed.msm<- readRDS(paste0(models, "hed.msm.RDS"))
AlcUse_year3 <-alc_sim(3)
# Load and format the transition probabilities
aTP_alc5 <- read_csv(paste0(output, "Supplement 1- Annual Transition Probabilities - AlcUse.csv")) %>%
mutate(cat = paste(sex, age_cat, edu, race, From, sep="_")) %>%
select(cat, To, Probability) %>%
group_by(cat) %>%
mutate(cumsum = cumsum(Probability)) %>%
ungroup()
# Load and set up the initial population (based on NESARC wave 1)
basepop <- nesarc %>%
select(idnum, wave, age, female_wave1.factor, race_wave1.factor, edu3.factor, alc5.factor) %>%
rename( sex = female_wave1.factor,
race = race_wave1.factor) %>%
pivot_wider(names_from="wave", values_from=c("alc5.factor", "age", "edu3.factor")) %>%
mutate (AlcUse_pred = alc5.factor_1,
AlcUse_1 = alc5.factor_1,
AlcUse_2 = alc5.factor_2,
age = age_1,
edu = edu3.factor_1) %>%
select(idnum, AlcUse_1, AlcUse_2, sex, age, edu, race, AlcUse_pred)
# Simulate population at 3 years follow-up
AlcUse_year3 <-alc_sim(3)
source("0_Functions.R")
