---
title: "Run microsimulation example"
format: html
editor: visual
---

## Script requires 0_model_settings.R to be run first

```{r}
seed <- (Sys.time())
samplenum <- 1
set.seed(seed)
Summary <- list()
DeathSummary <- list()
PopPerYear <- list()
transitionyears <- seq(2002,2018, by=2)
#set y to 2002 - for demonstration purposes 
y <- 2002
print(y)
```

```{r}
# add and remove migrants
if(y>=2001){
  basepop <- inward_migration(basepop,migration_rates,y, brfss)
  basepop <- outward_migration(basepop,migration_rates,y)
}
```

```{r}
# apply death rates and summarise deaths by cause
if(y>=2000){
basepop <- apply_death_rates(basepop, death_rates, y)
DeathSummary[[paste(y)]] <- basepop %>% filter(dead==1) %>% dplyr::select(agecat, microsim.init.race, microsim.init.sex, microsim.init.education,
                                              dead, cause) %>% mutate(year=y, seed=seed)
basepop <- basepop %>% filter(dead==0) %>% dplyr::select(-c(dead, cause))
}
```
